---
name: 'ci'

'on':
  pull_request:
    branches:
      - 'main'
  workflow_dispatch:

permissions:
  contents: 'read'

jobs:
  docs:
    name: 'docs'
    runs-on: 'ubuntu-latest'
    steps:
      - name: 'checkout repository'
        uses: 'actions/checkout@v6'
        with:
          persist-credentials: false
      - name: 'setup just and uv'
        uses: './.github/actions/setup-just-and-uv'
      - name: 'build documentation'
        run: 'just docs'
  quality:
    name: 'quality'
    runs-on: 'ubuntu-latest'
    steps:
      - name: 'checkout repository'
        uses: 'actions/checkout@v6'
        with:
          persist-credentials: false
      - name: 'setup just and uv'
        uses: './.github/actions/setup-just-and-uv'
      - name: 'run quality checks'
        run: 'just quality'
  tests:
    name: 'tests (${{ matrix.python-version }}-${{ matrix.coverage }})'
    needs:
      - 'docs'
      - 'quality'
    runs-on: 'ubuntu-latest'
    strategy:
      matrix:
        include:
          - python-version: '3.11'
            coverage: false
          - python-version: '3.12'
            coverage: true
          - python-version: '3.13'
            coverage: false
          - python-version: '3.14'
            coverage: false
    steps:
      - name: 'checkout repository'
        uses: 'actions/checkout@v6'
        with:
          persist-credentials: false
      - name: 'setup just and uv with python ${{ matrix.python-version }}'
        uses: './.github/actions/setup-just-and-uv'
        with:
          python-version: '${{ matrix.python-version }}'
      - name: 'run coverage tests'
        if: '${{ matrix.coverage }}'
        run: 'just cov'
      - name: 'run integration tests'
        if: '${{ matrix.coverage }}'
        run: 'just integration'
      - name: 'run full pytest suite'
        if: '${{ !matrix.coverage }}'
        run: 'just pytest'
